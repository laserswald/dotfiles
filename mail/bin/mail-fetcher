#!/bin/sh

MAIL_PID_FILE=$HOME/var/mail.pid
if [ -f $MAIL_PID_FILE ]; then
    notify-send -i 'mail' "Mail" "Mail daemon already running."
    exit 0
fi

# notify-send -i mail-send-recieve "Mail" "Fetching mail..."
notmuch new
echo $! > $MAIL_PID_FILE

unread_count=$(notmuch count tag:inbox AND tag:unread)
if [ $unread_count -gt 0 ]
then
    notify-send -i mail-unread "Mail" "You have $unread_count unread messages."
fi
trap "rm $MAIL_PID_FILE" EXIT
